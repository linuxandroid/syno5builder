/* Copyright (c) 2014 Synology Inc. All rights reserved. */

Ext.namespace("SYNO.SDS.TaskRunner");SYNO.SDS._TaskMgr=function(n){var e=n||10,h=[],a=[],d=0,i=false,l=false,j=function(o,p){while(p!==0){w=o%p;o=p;p=w}return o},g=function(){var p,o,q=h[0].interval;for(p=1;(o=h[p]);p++){q=j(q,o.interval)}return Math.max(q,n)},f=function(){var o=g();if(o!==e){e=o;return true}return false},c=function(){i=false;clearTimeout(d);d=0},k=function(){if(!i){i=true;f();d=setTimeout(m,0)}},b=function(o){a.push(o);if(o.onStop){o.onStop.apply(o.scope||o)}},m=function(){var u,s,r,o,p,x=false,q=new Date().getTime();for(u=0;(s=a[u]);u++){h.remove(s);x=true}a=[];if(!h.length){c();return}for(u=0;(s=h[u]);++u){s=h[u];if(l&&s.preventHalt!==true){b(s);continue}o=q-s.taskRunTime;if(s.interval<=o){try{p=s.run.apply(s.scope||s,s.args||[++s.taskRunCount])}catch(v){SYNO.Debug("TaskRunner: task "+s.id+" exception: "+v);if(Ext.isDefined(SYNO.SDS.JSDebug)){s.taskRunTime=q;throw v}}s.taskRunTime=q;r=s.interval;s.interval=s.adaptiveInterval();if(r!==s.interval){x=true}if(p===false||s.taskRunCount===s.repeat){b(s);return}}if(s.duration&&s.duration<=(q-s.taskStartTime)){b(s)}}if(x){f()}d=setTimeout(arguments.callee,e)};this.start=function(p,o){var q=new Date().getTime();h.push(p);p.taskStartTime=q;p.taskRunTime=(false===o)?q:0;p.taskRunCount=0;if(!i){k()}else{f();clearTimeout(d);d=setTimeout(m,0)}return p};this.stop=function(o){b(o);return o};this.stopAll=function(){var p,o;c();for(p=0;(o=h[p]);p++){if(o.onStop){o.onStop()}}h=[];a=[]};this.setHalt=function(o){l=o}};SYNO.SDS.TaskMgr=new SYNO.SDS._TaskMgr(100);SYNO.SDS.TaskRunner=Ext.extend(Ext.util.Observable,{tasks:null,constructor:function(){SYNO.SDS.TaskRunner.superclass.constructor.apply(this,arguments);this.addEvents("add","remove","beforestart");this.tasks={}},destroy:function(){this.stopAll();this.tasks={};this.isDestroyed=true},start:function(b,a){if(this.isDestroyed){return}if(!b.running){this.fireEvent("beforestart",b);SYNO.SDS.TaskMgr.start(b,a)}b.running=true;return b},stop:function(a){if(a.running){SYNO.SDS.TaskMgr.stop(a)}a.running=false;return a},stopAll:function(){for(var a in this.tasks){if(!this.tasks[a].running){continue}SYNO.SDS.TaskMgr.stop(this.tasks[a])}},addTask:function(a){a.id=a.id||Ext.id();this.tasks[a.id]=a;this.fireEvent("add",a);return a},createTask:function(b){b.id=b.id||Ext.id();var a=this.tasks[b.id];if(a){a.apply(b)}else{a=new SYNO.SDS.TaskRunner.Task(b,this);this.addTask(a)}return a},createAjaxTask:function(b){b.id=b.id||Ext.id();var a=this.tasks[b.id];if(a){a.apply(b)}else{a=new SYNO.SDS.TaskRunner.AjaxTask(b,this);this.addTask(a)}return a},removeTask:function(b){var a=this.tasks[b];if(a){this.fireEvent("remove",a);delete this.tasks[b]}},getTask:function(a){return this.tasks[a]||null}});SYNO.SDS.TaskRunner.Task=Ext.extend(Ext.util.Observable,{INTERVAL_DEFAULT:60000,INTERVAL_FALLBACK:60000,manager:null,running:false,removed:false,taskFirstRunTime:0,constructor:function(a,b){SYNO.SDS.TaskRunner.Task.superclass.constructor.apply(this,arguments);this.manager=b;this.apply(a)},apply:function(a){this.applyInterval(a.interval);delete a.interval;this.applyConfig(a)},applyConfig:function(a){Ext.apply(this,a)},applyInterval:function(a){this.intervalData=a;if(!Ext.isFunction(this.intervalData)&&!Ext.isArray(this.intervalData)&&!Ext.isNumber(this.intervalData)){this.intervalData=this.INTERVAL_DEFAULT}this.interval=this.adaptiveInterval()},adaptiveInterval:function(){var c,b=0,d=this.intervalData,a=null;if(this.taskFirstRunTime){b=new Date().getTime()-this.taskFirstRunTime}if(Ext.isNumber(d)){a=d}else{if(Ext.isFunction(d)){a=d.call(this.scope||this,b)}else{if(Ext.isArray(d)){for(c=0;c<d.length;++c){if(d[c].time>b){break}a=d[c].interval}}}}if(!Ext.isNumber(a)){SYNO.Debug("TaskRunner: Task "+this.id+" interval fallback to "+this.INTERVAL_FALLBACK);a=this.INTERVAL_FALLBACK}return a},start:function(a){var b=new Date().getTime();if(this.removed){return}if(!this.taskFirstRunTime){this.taskFirstRunTime=(false===a)?b+this.interval:b}return this.manager.start(this,a)},stop:function(){if(this.removed){return}return this.manager.stop(this)},restart:function(a){this.stop();this.start(a)},remove:function(){this.stop();this.manager.removeTask(this.id);this.removed=true}});SYNO.SDS.TaskRunner.AjaxTask=Ext.extend(SYNO.SDS.TaskRunner.Task,{reqId:null,reqConfig:null,cbHandler:null,autoJsonDecode:false,single:false,constructor:function(a,b){SYNO.SDS.TaskRunner.AjaxTask.superclass.constructor.call(this,a,b)},applyConfig:function(a){Ext.apply(this,{run:this.run,scope:this});this.autoJsonDecode=(true===a.autoJsonDecode);this.single=(true===a.single);this.preventHalt=(true===a.preventHalt);this.cbHandler={};this.reqConfig={};Ext.copyTo(this.cbHandler,a,["scope","callback","success","failure"]);Ext.apply(this.reqConfig,a);Ext.apply(this.reqConfig,{success:null,failure:null,callback:this.onCallback,scope:this});Ext.applyIf(this.reqConfig,{method:"GET"});delete this.reqConfig.id;delete this.reqConfig.autoJsonDecode;delete this.reqConfig.single},stop:function(){if(this.reqId){Ext.Ajax.abort(this.reqId);this.reqId=null}SYNO.SDS.TaskRunner.AjaxTask.superclass.stop.apply(this,arguments)},run:function(){SYNO.SDS.TaskRunner.AjaxTask.superclass.stop.call(this);this.reqId=Ext.Ajax.request(this.reqConfig)},onCallback:function(d,g,b){var a=b,c=Ext.apply({},d);Ext.apply(c,{scope:this.cbHandler.scope,callback:this.cbHandler.callback,success:this.cbHandler.success,failure:this.cbHandler.failure});if(g&&this.autoJsonDecode){try{a=Ext.util.JSON.decode(b.responseText)}catch(f){a={success:false};g=false}}if(g&&c.success){c.success.call(c.scope,a,d)}else{if(!g&&c.failure){c.failure.call(c.scope,a,d)}}if(c.callback){c.callback.call(c.scope,d,g,a)}this.fireEvent("callback",d,g,a);if(g&&this.single){this.reqId=null;this.remove()}else{if(this.reqId){this.reqId=null;this.start(false)}}}});Ext.override(Ext.Component,{getTaskRunner:function(){if(!this.taskRunner){this.taskRunner=new SYNO.SDS.TaskRunner();this.addManagedComponent(this.taskRunner)}return this.taskRunner},addTask:function(a){return this.getTaskRunner().createTask(a)},addAjaxTask:function(a){return this.getTaskRunner().createAjaxTask(a)},getTask:function(a){if(!this.taskRunner){return null}return this.taskRunner.getTask(a)},removeTask:function(b){var a=this.getTask(b);if(a){a.remove()}return a},addManagedComponent:function(a){this.components=this.components||[];this.components.push(a);return a},removeManagedComponent:function(a){this.components=this.components||[];this.components.remove(a);return a},beforeDestroy:function(){this.taskRunner=null;this.components=this.components||[];for(var a=0;a<this.components.length;++a){try{this.components[a].destroy()}catch(b){if(Ext.isDefined(SYNO.SDS.JSDebug)){SYNO.Debug(this.id+" sub-components["+a+"] destroy failed.");SYNO.Debug(this.components[a]);throw b}}}delete this.components}});Ext.override(Ext.form.TextField,{onRender:function(d,a){if(!this.withCssFrame){Ext.form.TextField.superclass.onRender.apply(this,[d,a]);return}var e=d.createChild({tag:"table",html:'<tbody><tr><td class="textfield-left"></td><td class="textfield-center"></td><td class="textfield-right"></td></tr></tbody>'});var c=e.query(".textfield-center");var b=new Ext.Element(c[0]);Ext.form.TextField.superclass.onRender.apply(this,[b,a])}});Ext.namespace("SYNO.Installer");SYNO.Installer.NetconfigStep=Ext.extend(SYNO.JBase.Wizard.FormPanelStep,{headline:_JSLIBSTR("network","netconfig_title"),description:_JSLIBSTR("network","netconfig_desc"),initComponent:function(){var a={synodefaults:{width:300},autoWidth:true,defaults:{listeners:{invalid:function(b,c){this.ownerCt.setError(b.id,c)},valid:function(b){this.ownerCt.clearError(b.id)},disable:function(b){this.ownerCt.clearError(b.id)}},labelWidth:220},items:[{synotype:"radio",itemCls:"synoradio",boxLabel:_JSLIBSTR("network","dhcp"),name:"netconfig",itemId:"netsetting_dhcp",inputValue:"dhcp"},{synotype:"radio",itemCls:"synoradio",boxLabel:_JSLIBSTR("network","manual"),name:"netconfig",itemId:"netsetting_manual",inputValue:"manual"},{synotype:"text",fieldLabel:_JSLIBSTR("dsinfo","ip_addr"),itemCls:"synotextfield",withCssFrame:true,msgTarget:"",name:"manual_ip",indent:1,allowBlank:false,maxlength:15,blankText:_JSLIBSTR("extlang","fieldblank"),vtype:"v4ip"},{synotype:"text",fieldLabel:_JSLIBSTR("network","network_netmask"),itemCls:"synotextfield",withCssFrame:true,msgTarget:"",name:"manual_mask",indent:1,allowBlank:false,maxlength:15,blankText:_JSLIBSTR("extlang","fieldblank"),vtype:"netmask"},{synotype:"text",fieldLabel:_JSLIBSTR("network","network_dns"),itemCls:"synotextfield",withCssFrame:true,msgTarget:"",name:"manual_dns",indent:1,allowBlank:false,maxlength:15,blankText:_JSLIBSTR("extlang","fieldblank"),vtype:"v4ip"},{synotype:"text",fieldLabel:_JSLIBSTR("network","network_def_gateway"),itemCls:"synotextfield",withCssFrame:true,msgTarget:"",name:"manual_gateway",indent:1,allowBlank:false,maxlength:15,blankText:_JSLIBSTR("extlang","fieldblank"),vtype:"v4ip"},{synotype:"radio",itemCls:"synoradio",boxLabel:_JSLIBSTR("network","pppoe"),name:"netconfig",itemId:"netsetting_pppoe",inputValue:"pppoe"}]};Ext.apply(this,SYNO.LayoutConfig.fill(a));SYNO.Installer.NetconfigStep.superclass.initComponent.apply(this,arguments)},initEvents:function(){SYNO.Installer.SelPatchStep.superclass.initEvents.apply(this,arguments);this.mon(this,"afterlayout",function(){var e=this.getComponent("netsetting_dhcp").el.next();var f=this.getComponent("netsetting_manual").el.next();var d=this.getComponent("netsetting_pppoe").el.next();if(e){this.mon(e,"click",Ext.emptyFn)}if(f){this.mon(f,"click",Ext.emptyFn)}if(d){this.mon(d,"click",Ext.emptyFn)}this.group=new SYNO.JBase.Util.EnableRadioGroup(this.getForm(),"netconfig",{manual:["manual_ip","manual_mask","manual_dns","manual_gateway"]})},this,{single:true});var a=function(d,e){if(e){d.getEl().next().removeClass("syno-radio-unchecked");d.getEl().next().addClass("syno-radio-checked")}else{d.getEl().next().removeClass("syno-radio-checked");d.getEl().next().addClass("syno-radio-unchecked")}};var b=function(d){d.getEl().parent().parent().removeClass("syno-textfield-enabled");d.getEl().parent().parent().addClass("syno-textfield-disabled");d.label.addClass("syno-label-textfield-disabled")};var c=function(d){d.getEl().parent().parent().removeClass("syno-textfield-disabled");d.getEl().parent().parent().addClass("syno-textfield-enabled");d.label.removeClass("syno-label-textfield-disabled")};this.mon(this.get("netsetting_dhcp"),"check",a,this);this.mon(this.get("netsetting_manual"),"check",a,this);this.mon(this.get("netsetting_pppoe"),"check",a,this);this.mon(this.getForm().findField("manual_ip"),"disable",b,this);this.mon(this.getForm().findField("manual_mask"),"disable",b,this);this.mon(this.getForm().findField("manual_dns"),"disable",b,this);this.mon(this.getForm().findField("manual_gateway"),"disable",b,this);this.mon(this.getForm().findField("manual_ip"),"enable",c,this);this.mon(this.getForm().findField("manual_mask"),"enable",c,this);this.mon(this.getForm().findField("manual_dns"),"enable",c,this);this.mon(this.getForm().findField("manual_gateway"),"enable",c,this)},activate:function(){var a=SYNO.JBase.Util.getRadioGroup(this.getForm(),"patch");if(!this.getForm().isDirty()){this.getForm().setValues({netconfig:"dhcp"})}},getNext:function(){if(!this.getForm().isValid()){return false}if("pppoe"===this.getForm().findField("netconfig").getGroupValue()){return this.nextId[1]}return this.nextId[0]}});SYNO.Installer.PPPoEStep=Ext.extend(SYNO.JBase.Wizard.FormPanelStep,{headline:_JSLIBSTR("network","pppoe_title"),description:_JSLIBSTR("network","pppoe_desc"),initComponent:function(){var a={synodefaults:{width:300},autoWidth:true,defaults:{listeners:{invalid:function(b,c){this.ownerCt.setError(b.id,c)},valid:function(b){this.ownerCt.clearError(b.id)}},labelWidth:220},items:[{synotype:"text",fieldLabel:_T("wizard","pppoe_username"),name:"pppaccount",itemCls:"synotextfield",withCssFrame:true,msgTarget:"",maxlength:256,allowBlank:false,blankText:_JSLIBSTR("extlang","fieldblank")},{synotype:"text",fieldLabel:_T("wizard","pppoe_password"),itemCls:"synotextfield",withCssFrame:true,validationEvent:"blur",inputType:"password",validateOnBlur:true,maxLength:256,name:"ppppasswd",msgTarget:"",itemId:"password"}]};Ext.apply(this,SYNO.LayoutConfig.fill(a));SYNO.Installer.PPPoEStep.superclass.initComponent.apply(this,arguments)},getNext:function(){if(!this.getForm().isValid()){return false}return this.nextId}});Ext.namespace("SYNO.Installer");SYNO.Installer.FormatHDForm=Ext.extend(Ext.form.FormPanel,{constructor:function(b){Ext.copyTo(this,b,"owner");var a=SYNO.Installer.view.getDSInfo("clean_all_partition_disks");this.cls="formathd";Ext.apply(this,SYNO.LayoutConfig.fill({autoWidth:true,padding:20,items:[{synotype:"desc",html:String.format(_T("wizard","format_hd_question"),"<b>"+a+"</b>")},{synotype:"desc",height:20},new SYNO.JBase.Util.Checkbox({xtype:"xcheckbox",itemId:"format_confirm",hideLabel:true,synotype:"check",boxLabel:"<font color='#BF1D1D'>"+String.format(_T("wizard","format_hd_confirm"),"<b>"+a+"</b>")+"</font>",itemCls:"webinstcheckbox",cls:"check"})]}));SYNO.Installer.FormatHDForm.superclass.constructor.apply(this,arguments)},initEvents:function(){SYNO.Installer.FormatHDForm.superclass.initEvents.apply(this,arguments);this.mon(this.get("format_confirm"),"check",function(a,b){if(b){this.owner.getFooterToolbar().get("apply").enable()}else{this.owner.getFooterToolbar().get("apply").disable()}},this)}});SYNO.Installer.FormatHDDialog=Ext.extend(Ext.Window,{constructor:function(b){Ext.copyTo(this,b,"callback,scope");var a=Ext.apply({closable:false,maximizable:false,minimizable:false,width:"400",layout:"anchor",title:_JSLIBSTR("common","title"),items:[new SYNO.Installer.FormatHDForm({owner:this})],buttons:[{itemId:"apply",text:_JSLIBSTR("common","apply"),disabled:true,scope:this,handler:this.applySetting},{itemId:"cancel",text:_JSLIBSTR("common","cancel"),scope:this,handler:this.cancelSetting}]},a);SYNO.Installer.FormatHDDialog.superclass.constructor.call(this,a)},applySetting:function(){this.callback.call(this.scope||window,true);this.close()},cancelSetting:function(){this.callback.call(this.scope||window,false);this.close()}});Ext.namespace("SYNO.Installer");SYNO.Installer.InfoStep=Ext.extend(Ext.form.FormPanel,{initComponent:function(){var a=180;this.headline=_T("wizard","info_step_title").replace("DiskStation",SYNO.Installer.view.getDSInfo("product","DiskStation"));this.cls="infostep";Ext.apply(this,SYNO.LayoutConfig.fill({autoWidth:true,items:[{synotype:"indent",xtype:"displayfield",labelWidth:a,fieldLabel:_JSLIBSTR("dsinfo","ds_model"),name:"model"},{synotype:"indent",xtype:"displayfield",labelWidth:a,fieldLabel:_JSLIBSTR("dsinfo","ip_addr"),name:"ip_addr"},{synotype:"indent",xtype:"displayfield",labelWidth:a,fieldLabel:_JSLIBSTR("dsinfo","mac_addr"),name:"mac_addr"},{synotype:"indent",xtype:"displayfield",labelWidth:a,fieldLabel:_T("wizard","serial_num"),name:"serial"},{synotype:"indent",xtype:"displayfield",labelWidth:a,fieldLabel:_JSLIBSTR("dsinfo","version"),name:"build_ver"},{synotype:"indent",xtype:"displayfield",labelWidth:a,fieldLabel:_JSLIBSTR("dsinfo","ds_status"),name:"status"}]}));SYNO.Installer.InfoStep.superclass.initComponent.apply(this,arguments)},activate:function(){var a=SYNO.Installer.view.getDSInfo("status");var b=this.getForm().findField("status");this.getForm().setValues(SYNO.Installer.view.dsinfo);if(!a){b.setValue("Unknown")}else{if("not_install"===a){b.setValue(_T("status","uninstall"))}else{if("updating"===a){b.setValue(_T("status","updating"))}else{if("sys_crash"===a){b.setValue(_T("status","crash"))}else{if("mem_testing"===a){b.setValue(_T("status","mem_testing"))}else{if("sys_recoverable"===a){b.setValue(_T("status","recoverable"))}else{if("sys_migrat"===a){b.setValue(_T("status","migrate"))}else{b.setValue("Unknown status ("+a+")")}}}}}}}if(SYNO.Installer.view.getDSInfo("is_installing")){this.owner.goNext("apply",true)}},showFormatDiskWarning:function(b){var a=b.trim().split(" ").sort().join(", ");var c=SYNO.Installer.view.getDSInfo("buildin_storage")?_T("wizard","warn_erase_sd_card"):String.format(_T("wizard","warn_erase_disk"),a);this.owner.setFormError(c,"wizard-infostep")},checkState:function(){var a=SYNO.Installer.view.getDSInfo("clean_all_partition_disks");var b=SYNO.Installer.view.getDSInfo("status");SYNO.JBase.Wizard.Step.prototype.checkState.call(this);if("mem_testing"===b){this.owner.getButton("next").disable()}if(a){this.showFormatDiskWarning(a)}},getNext:function(){var a;if("mem_testing"===SYNO.Installer.view.getDSInfo("status")){return false}Ext.each(this.nextId,function(b){if(this.owner.getStep(b)){a=b;return false}},this);return a}});SYNO.Installer.MigrateStep=Ext.extend(Ext.form.FormPanel,{headline:_T("wizard","migrate_step_title"),cls:"infostep",initComponent:function(){var a={autoWidth:true,items:[{synotype:"radio",itemId:"migrate",itemCls:"synoradio",boxLabel:_T("wizard","system_migration"),name:"install_type",inputValue:"sys_migrat"},{synotype:"desc",indent:1,value:String.format(_T("wizard","system_migration_info"),"http://www.synology.com/support/tutorials_show.php?q_id=484")},{synotype:"radio",itemId:"clean_install",itemCls:"synoradio",boxLabel:_T("wizard","clean_install"),name:"install_type",inputValue:"sys_crash"},{synotype:"desc",indent:1,value:_T("wizard","clean_install_info")}]};Ext.apply(this,SYNO.LayoutConfig.fill(a));SYNO.Installer.MigrateStep.superclass.initComponent.apply(this,arguments)},initEvents:function(){SYNO.Installer.MigrateStep.superclass.initEvents.apply(this,arguments);this.mon(this,"afterlayout",function(){var c,b;c=this.getComponent("migrate").el.next();if(c&&c.id){this.mon(c,"click",Ext.emptyFn)}b=this.getComponent("clean_install").el.next();if(b){this.mon(b,"click",Ext.emptyFn)}},this,{single:true});var a=function(b,c){if(c){b.getEl().next().removeClass("syno-radio-unchecked");b.getEl().next().addClass("syno-radio-checked")}else{b.getEl().next().removeClass("syno-radio-checked");b.getEl().next().addClass("syno-radio-unchecked")}};this.mon(this.get("migrate"),"check",a,this);this.mon(this.get("clean_install"),"check",a,this)},activate:function(){if(!this.getForm().isDirty()){this.getForm().setValues({install_type:"sys_migrat"})}},getNext:function(){var a;if(SYNO.Installer.view.getDSInfo("support_wireless")&&!SYNO.Installer.view.getDSInfo("is_wireless")){return this.nextId[1]}Ext.each(this.nextId,function(b){if(this.owner.getStep(b)){a=b;return false}},this);return a}});SYNO.Installer.SelPatchStep=Ext.extend(Ext.form.FormPanel,{headline:_T("wizard","patch_step_title"),description:_T("wizard","patch_step_desc"),cls:"infostep",initComponent:function(){var a={fileUpload:true,autoWidth:true,items:[{synotype:"radio",itemCls:"synoradio",boxLabel:(SYNO.Installer.view.getDSInfo("internet_ok")||SYNO.Installer.view.getDSInfo("support_wireless"))?_T("wizard","download_patch"):String.format("{0} ({1})",_T("wizard","download_patch"),String.format(_T("wizard","download_warn"),"DiskStation")),disabled:!(SYNO.Installer.view.getDSInfo("internet_ok")||SYNO.Installer.view.getDSInfo("support_wireless")),name:"patch",itemId:"download_patch",inputValue:"download"}]};if(SYNO.Installer.view.getDSInfo("support_boot_install")){a.items.push({synotype:"radio",itemCls:"synoradio",boxLabel:_T("wizard","boot_patch"),name:"patch",itemId:"boot_patch",inputValue:"boot"})}a.items.push({synotype:"radio",itemCls:"synoradio",boxLabel:_T("wizard","upload_patch"),name:"patch",itemId:"upload_item",inputValue:"upload"},{xtype:"hidden",name:"hostname"},{xtype:"hidden",name:"password"},{xtype:"hidden",name:"create_shr"},{xtype:"hidden",name:"timezone"},{synotype:"indent_no_label",itemCls:"synotextfield",xtype:"textfield",inputType:"file",id:"update_file",name:"filename"});Ext.apply(this,SYNO.LayoutConfig.fill(a));SYNO.Installer.SelPatchStep.superclass.initComponent.apply(this,arguments)},initEvents:function(){SYNO.Installer.SelPatchStep.superclass.initEvents.apply(this,arguments);this.mon(this,"afterlayout",function(){var b,h,c,f;var g=SYNO.JBase.Util.getRadioGroup(this.getForm(),"patch");this.group=new SYNO.JBase.Util.EnableRadioGroup(this.getForm(),"patch",{upload:["filename"]});for(var e=0;e<g.length;e++){var d=g[e];d.mon(d,"check",function(){this.owner.setFormError(null)},this)}b=this.getComponent("upload_item").el.next();if(b&&b.id){f=new Ext.ToolTip({target:b.id,showDelay:0,hideDelay:1000,html:String.format(_T("wizard","upload_info"),"DiskStation")});this.mon(b,"click",Ext.emptyFn)}h=this.getComponent("download_patch").el.next();if(h){this.mon(h,"click",Ext.emptyFn)}c=this.getComponent("boot_patch");if(c&&c.el.next()){this.mon(c.el.next(),"click",Ext.emptyFn)}},this,{single:true});var a=function(b,c){if(c){b.getEl().next().removeClass("syno-radio-unchecked");b.getEl().next().addClass("syno-radio-checked")}else{b.getEl().next().removeClass("syno-radio-checked");b.getEl().next().addClass("syno-radio-unchecked")}};this.mon(this.get("download_patch"),"check",a,this);this.mon(this.get("upload_item"),"check",a,this);if(this.get("boot_patch")){this.mon(this.get("boot_patch"),"check",a,this)}},validFile:function(){var b=this.getForm();if(!b.findField("filename").isDirty()){this.owner.setFormError(_T("error","error_nochoosefile"));return false}else{var c=b.findField("filename").getValue();var a=c.substr(c.length-4,4);if(a!=".pat"){this.owner.setFormError(_T("wizard","error_filename"));return false}}this.owner.setFormError(null);return true},activate:function(){var a=this.get("boot_patch");if(a){if(true!=SYNO.Installer.view.getDSInfo("boot_pat_ok")){a.disable()}else{a.enable()}}if(!this.getForm().isDirty()){if(true===SYNO.Installer.view.getDSInfo("internet_ok")){this.getForm().setValues({patch:"download"})}else{if(a&&!a.disabled){this.getForm().setValues({patch:"boot"})}else{this.getForm().setValues({patch:"upload"})}}}},getNext:function(){var a=this.getForm();if("download"===a.getValues().patch&&!(SYNO.Installer.view.getDSInfo("internet_ok")||SYNO.Installer.view.getDSInfo("support_wireless"))){return false}if("boot"===a.getValues().patch&&!SYNO.Installer.view.getDSInfo("support_boot_install")){return false}if("upload"===a.getValues().patch&&!this.validFile()){return false}this.owner.setFormError(null);if(SYNO.Installer.view.getDSInfo("support_wireless")&&"download"===this.getForm().findField("patch").getGroupValue()){return this.nextId[1]}return this.nextId[0]}});SYNO.Installer.DSConfigStep=Ext.extend(SYNO.JBase.Wizard.FormPanelStep,{headline:_T("wizard","dsconfig_step_title"),description:_T("wizard","dsconfig_step_desc"),commitBtnText:_T("wizard","install_now"),initComponent:function(a){Ext.apply(this,SYNO.LayoutConfig.fill({synodefaults:{width:300},cls:"configstep",autoWidth:true,defaults:{labelWidth:220,msgTarget:"",invalidClass:"",listeners:{invalid:function(b,c){this.ownerCt.setError(b.id,c)},valid:function(b){this.ownerCt.clearError(b.id)}}},items:[{synotype:"indent",fieldLabel:_T("wizard","admin_acc"),name:"admin_account",value:"admin",xtype:"displayfield"},{synotype:"text",itemCls:"synotextfield",withCssFrame:true,inputType:"password",validateOnBlur:true,validationEvent:"blur",fieldLabel:_T("wizard","password_create"),maxLength:127,name:"password",msgTarget:"",itemId:"password"},{synotype:"text",itemCls:"synotextfield",withCssFrame:true,inputType:"password",validateOnBlur:true,validationEvent:"blur",fieldLabel:_T("wizard","password_confirm"),maxLength:127,name:"confirmpasswd",confirmFor:"password",msgTarget:"",validator:function(d){if(!this.ownerCt){return"Failed to find ownerCt"}var b=this.ownerCt.get(this.confirmFor);var c=b.getValue();if(d!==c){return _JSLIBSTR("vtype","password_confirm_failed")}return true}},{synotype:"text",fieldLabel:_T("wizard","server_name"),itemCls:"synotextfield",withCssFrame:true,name:"hostname",maxlength:15,vtype:"netbiosName",msgTarget:"",blankText:String.format(_JSLIBSTR("common","error_blank"),_T("wizard","server_name")),allowBlank:false},new SYNO.JBase.Util.Checkbox({xtype:"xcheckbox",hideLabel:true,synotype:"check",boxLabel:_T("wizard","create_shr")+' <font color="#B2DFFF">'+_T("wizard","suggested")+"</font>",name:"createvol",itemCls:"webinstcheckbox",height:25,checked:true,cls:"check"}),{xtype:"displayfield",hideLabel:true,itemCls:"noticefield",height:25,value:_T("wizard","eula")}]}));SYNO.Installer.DSConfigStep.superclass.initComponent.apply(this,arguments)},activate:function(){var a=this.owner.getStep("migrate");if(this.getForm().isDirty()){return}if(SYNO.Installer.view.dsinfo){this.getForm().setValues({hostname:SYNO.Installer.view.dsinfo.hostname})}if(true===SYNO.Installer.view.getDSInfo("show_shr")&&"not_install"===SYNO.Installer.view.getDSInfo("status")){this.getForm().findField("createvol").enable();this.getForm().findField("createvol").show()}else{this.getForm().findField("createvol").disable();this.getForm().findField("createvol").hide()}},getNext:function(){var b;var a=SYNO.Installer.view.getDSInfo("clean_all_partition_disks");if(!this.getForm().isValid()){return false}SYNO.Installer.view.dsinfo.hostname=this.getForm().findField("hostname").getValue();if(a){b=new SYNO.Installer.FormatHDDialog({callback:function(c){Ext.getBody().unmask();if(!c){return}this.owner.goNext(this.nextId)},scope:this});Ext.getBody().mask();b.show();return false}return this.nextId}});SYNO.Installer.ApplyStep=Ext.extend(Ext.Panel,{headline:_T("wizard","apply_step_title"),description:_T("wizard","apply_step_desc"),PollTask:null,rebootPollingTask:null,countDownTask:null,SECONDS_REBOOT:600,rebootPollingStartTime:500,rebootPollingTaskStarted:false,redoStep:null,pollFailCnt:0,installStage:"",installPercent:0,midBarId:null,initComponent:function(a){this.cls=(SYNO.Installer.view.getDSInfo("support_wireless"))?"wireless_applystep":undefined;this.midBarId=Ext.id();Ext.apply(this,SYNO.LayoutConfig.fill({autoWidth:true,items:[{synotype:"desc",itemId:"action",height:37,cls:"applystep-action",value:""},{itemId:"progress",xtype:"box",style:{position:"relative"},html:'<div class="inst-progress-bar-wrap"><div class="inst-progress-bar"><div class="inst-progress-bar-l"></div><div class="inst-progress-bar-m" id='+this.midBarId+'></div><div class="inst-progress-bar-r"></div></div></div><div class="inst-progress-bar-inner" align="center"></div>'},{synotype:"desc",cls:"applystep-waitdesc",value:String.format(_T("wizard","waiting_desc"),'<a href="http://www.synology.com" style="color:#B2DFFF; font-weight:bold"target="_blank">www.synology.com</a>')}]}));SYNO.Installer.ApplyStep.superclass.initComponent.apply(this,arguments)},doRecover:function(){var a=false;var d=0;var c=new Date();var b=function(){if(a){return}this.updateProgress(_T("wizard","recover_start"),d);d+=1;b.defer(2000,this)};b.call(this);Ext.Ajax.request({url:"webman/recover.cgi?_dc="+(c.getTime()),params:{utctime:c.format("U")},timeout:"300000",callback:function(e,h,g){var f=null;var i=function(j){this.redoStep="dsinfo";this.getComponent("progress").disable();this.owner.setFormError(j,"wizard-applystep");this.checkState()};a=true;f=SYNO.JBase.Util.reportAjaxResponse(h,g,i,this);if(!f||!f.success){return}Ext.Ajax.request({url:"webman/reboot.cgi?_dc="+(new Date().getTime()),method:"POST",success:function(){this.updateProgress(_T("wizard","upgrade_reb"),100);this.startRebootCountDown()},failure:function(k,j){this.ajaxErrorHandler(_T("error","error_unknown"))},scope:this})},scope:this})},startInstall:function(){var m=null;var l=null;var g=null;var j=null;var d=null;var f=null;var o={};var b=null,k=null,e=null;var a=180000;var c=new Date();var h=c.format("P");var i=this.owner.getStep("migrate");var n=SYNO.Installer.view.getDSInfo("status");if("sys_recoverable"===SYNO.Installer.view.getDSInfo("status")){this.doRecover();return}if(i){n=i.getForm().findField("install_type").getGroupValue()}b=this.owner.getStep("dsconfig").getForm();k=b.getValues();e=b.getValues().createvol?true:false;o={upload:false,create_shr:e,hostname:k.hostname,timezone:h,password:k.password};if(SYNO.Installer.view.getDSInfo("support_wireless")&&this.owner.inHistory("netconfig")){a=210000;j=this.owner.getStep("netconfig").getForm();d=j.findField("netconfig").getGroupValue();netConfig=j.getValues();f=this.owner.getStep("pppoe").getForm().getValues();o=Ext.apply(o,j.getValues());if("pppoe"===d){o.ppp_account=f.pppaccount;o.ppp_passwd=f.ppppasswd}if(SYNO.Installer.view.getDSInfo("support_wireless")&&SYNO.Installer.view.getDSInfo("is_wireless")){o.autoreboot=true}}m=this.owner.getStep("selpatch");if(m){l=m.getForm();g=l.findField("patch").getGroupValue()}c=new Date();if(this.owner.inHistory("selpatch")&&l&&"upload"===g){l=m.getForm();l.timeout=180;l.findField("create_shr").setValue(e);l.findField("hostname").setValue(k.hostname);l.findField("password").setValue(k.password);l.findField("timezone").setValue(h);l.doAction("submit",{url:"webman/install.cgi?upload=true&status="+n+"&utctime="+c.format("U")+"&_dc="+c.getTime(),method:"POST",success:function(p,q){SYNO.JBase.Util.reportAjaxResponse(true,q.response,this.ajaxErrorHandler,this)},failure:function(p,q){SYNO.JBase.Util.reportAjaxResponse(true,q.response,this.ajaxErrorHandler,this)},scope:this})}else{o.buildin=("boot"===g);Ext.Ajax.request({url:"webman/install.cgi?upload=false&status="+n+"&utctime="+c.format("U")+"&_dc="+c.getTime(),timeout:a,params:o,method:"POST",callback:function(p,s,r){var q=null;q=SYNO.JBase.Util.reportAjaxResponse(s,r,this.ajaxErrorHandler,this);if(q&&q.success&&""!==q.redirectIP&&(!SYNO.Installer.view.getDSInfo("is_wireless"))&&q.redirectIP!==SYNO.Installer.view.getDSInfo("ip_addr")){if(this.PollTask){this.PollTask.stop();this.PollTask.remove()}this.redirect(q.redirectIP,SYNO.Installer.view.getDSInfo("ip_addr"),2000)}},scope:this})}this.updateProgress(_T("wizard","status_start"),0);this.startPollTask.defer(1000,this)},redirect:function(a,c,e){var d=e||20000;var b=0;window.onbeforeunload=null;var f=function(g){window.location.replace("http://"+g)};f.defer(d,this,[a]);for(b=0;b<3;b++){d+=8000;f.defer(d,this,[a])}for(b=0;b<3;b++){d+=10000;f.defer(d,this,[c])}return},hasInstall:function(){this.updateProgress(_T("wizard","status_start"),0);this.startPollTask.defer(1000,this)},activate:function(){this.redoStep=null;this.pollFailCnt=0;this.installStage="";this.installPercent=0;this.getComponent("progress").enable();if(SYNO.Installer.view.getDSInfo("is_installing")){this.hasInstall()}else{Ext.Ajax.request({url:"webman/lock_check.cgi?_dc="+(new Date().getTime()),method:"GET",callback:function(a,d,c){var b=SYNO.JBase.Util.reportAjaxResponse(d,c,this.ajaxErrorHandler,this);if(!b||!b.data){return}this.startInstall()},scope:this})}},checkState:function(){this.owner.getButton("next").getEl().hide();if(this.redoStep){if("sys_recoverable"===SYNO.Installer.view.getDSInfo("status")){this.owner.getButton("back").handler=function(){window.onbeforeunload=null;window.location=""}}this.owner.getButton("back").getEl().show()}else{this.owner.getButton("back").getEl().hide()}},getBack:function(){return this.redoStep||false},updateProgress:function(a,f,h){var b,e,d,c=0;var g=Ext.get(this.getComponent("progress").el);if(!g||!Ext.isNumber(f)){return}if(a&&Ext.isString(a)){this.getComponent("action").setValue(a)}e=g.child("div.inst-progress-bar");d=Ext.get(this.midBarId);f=parseInt(f,10);if(100<f){f=100}if(0===f){e.hide()}else{e.show();c=f*554/100;d.setStyle("width",c+"px")}b=Ext.getDom(g.child("div.inst-progress-bar-inner"));b.innerHTML=h?h:f+" %"},startPollTask:function(b,a){if(this.redoStep){return}this.PollTask=this.addAjaxTask({interval:5000,url:"webman/get_install_progress.cgi?_dc="+(new Date().getTime()),scope:this,callback:this.pollHandler});this.PollTask.start(true)},ajaxErrorHandler:function(a){if(this.PollTask){this.PollTask.stop();this.PollTask.remove()}if(SYNO.Installer.view.getDSInfo("is_wireless")&&(!this.owner.inHistory("netconfig"))){this.owner.stepStack.push("netconfig");SYNO.Installer.view.setDSInfo("is_installing",false)}else{if(!this.owner.inHistory("selpatch")){this.owner.stepStack.push("selpatch");SYNO.Installer.view.setDSInfo("is_installing",false)}}if(this.owner.getStep("migrate")){this.redoStep="migrate"}else{if(SYNO.Installer.view.getDSInfo("support_wireless")&&this.owner.inHistory("netconfig")){this.redoStep="netconfig"}else{this.redoStep="selpatch"}}this.getComponent("progress").disable();this.owner.setFormError(a,"wizard-applystep");this.checkState()},custStringFn:function(d,b){var e=_T(d,b);var a=SYNO.Installer.view.getDSInfo("build_num");var c;if("error"===d&&"error_model"===b){e=String.format(e,SYNO.Installer.view.dsinfo.model)}else{if("error"===d&&"error_version"===b){c=SYNO.Installer.view.getDSInfo("disk_sysinfo");if(c&&c.build_num>a){a=c.build_num}e=String.format(e,a)}else{if("error"===d&&"boot_damaged"===b){SYNO.Installer.view.setDSInfo("boot_pat_ok",false)}}}return e},pollErrorHandler:function(a){if(this.pollFailCnt<3){this.pollFailCnt++;return}this.ajaxErrorHandler(a)},pollHandler:function(e,g,c){var b=this.getComponent("progress");var a={net_setting:{min:1,max:3,sec:"wizard",key:"net_set"},chk_boot:{min:4,max:8,sec:"wizard",key:"boot_chk"},format_sys:{min:8,max:40,sec:"wizard",key:"status_format_sys"},upload:{min:40,max:55,sec:"wizard",key:"status_upload"},download_rss:{min:40,max:42,sec:"wizard",key:"status_download"},download:{min:42,max:55,sec:"wizard",key:"status_download"},install:{min:55,max:95,sec:"wizard",key:"status_install"},Success:{min:100,max:100,sec:"wizard",key:"upgrade_reb"}};var d=0;var f;if(!g){return}if(!c||!c.responseText){return}f=SYNO.JBase.Util.reportAjaxResponse(g,c,this.pollErrorHandler,this,this.custStringFn);if(!f){return}if(!f.data||!f.data.stage){return}if(!a[f.data.stage]){SYNO.Debug("unknown stage: ",f.data.stage);return}d=a[f.data.stage].min;if("download"===f.data.stage&&f.data.progress){d+=f.data.progress*0.13}else{if(this.installStage===f.data.stage){d=this.installPercent;if(this.installPercent<a[f.data.stage].max){d++}}}this.installStage=f.data.stage;this.installPercent=d;this.updateProgress(_T(a[f.data.stage].sec,a[f.data.stage].key),d);if("Success"===f.data.stage){this.PollTask.stop();Ext.Ajax.request({url:"webman/reboot.cgi?_dc="+(new Date().getTime()),method:"POST",success:this.startRebootCountDown,failure:function(i,h){if(!SYNO.Installer.view.getDSInfo("is_wireless")){this.ajaxErrorHandler(_T("error","error_unknown"))}else{this.startRebootCountDown(i,h)}},scope:this})}},startRebootCountDown:function(b,a){this.rebootCounter=this.SECONDS_REBOOT;this.rebootPollingTask=this.addAjaxTask({preventHalt:true,interval:3000,url:"/webman/pingpong.cgi?_dc="+(new Date().getTime()),method:"POST",autoJsonDecode:true,success:this.onPingPongDone,scope:this});this.countDownTask=new Ext.util.DelayedTask(this.countDownReboot,this);this.countDownReboot()},onPingPongDone:function(a,b){var c;if(a&&a.boot_done){window.onbeforeunload=null;this.rebootPollingTask.stop();c=new Date().getTime();window.location.href="/?dc="+c}},countDownReboot:function(){var b=String.format("{0}: {1} {2}",_T("wizard","upgrade_reb"),this.rebootCounter,_T("wizard","timer_unit"));var a=this.rebootCounter/this.SECONDS_REBOOT*100;if(this.rebootCounter<=this.rebootPollingStartTime){if(this.rebootPollingTaskStarted==false){this.rebootPollingTask.start();this.rebootPollingTaskStarted=true}}this.updateProgress(null,a,b);if(0===this.rebootCounter){this.rebootPollingTask.stop();SYNO.Installer.view.launch("redirectfail");return}this.rebootCounter--;if(this.countDownTask){this.countDownTask.delay(1000)}}});SYNO.Installer.Wizard=Ext.extend(SYNO.JBase.Wizard,{showLogo:true,dsinfo:null,patchPath:null,prepareSteps:function(){var a=[new SYNO.Installer.InfoStep({owner:this,itemId:"dsinfo",nextId:["migrate","selpatch","netconfig","apply"],headline:SYNO.Installer.view.getDSInfo("buildin_storage")?String.format(_T("wizard","info_step_title_usb_station"),SYNO.Installer.view.getDSInfo("product")):_T("wizard","info_step_title"),description:SYNO.Installer.view.getDSInfo("buildin_storage")?_T("wizard","info_step_desc_usb_station"):_T("wizard","info_step_desc")})];if("sys_recoverable"===SYNO.Installer.view.getDSInfo("status")){a[0].commitBtnText=_T("wizard","recover_now");a.push(new SYNO.Installer.ApplyStep({owner:this,itemId:"apply",nextId:null}));return a}if("sys_migrat"===SYNO.Installer.view.getDSInfo("status")){a.push(new SYNO.Installer.MigrateStep({owner:this,itemId:"migrate",nextId:["netconfig","selpatch"],description:SYNO.Installer.view.getDSInfo("buildin_storage")?String.format(_T("wizard","migrate_step_desc_usb_station"),SYNO.Installer.view.getDSInfo("product")):_T("wizard","migrate_step_desc")}))}if(!SYNO.Installer.view.getDSInfo("support_wireless")||!SYNO.Installer.view.getDSInfo("is_wireless")){a.push(new SYNO.Installer.SelPatchStep({owner:this,itemId:"selpatch",nextId:["dsconfig","netconfig"]}))}if(SYNO.Installer.view.getDSInfo("support_wireless")){a.push(new SYNO.Installer.NetconfigStep({owner:this,itemId:"netconfig",nextId:["dsconfig","pppoe"]}),new SYNO.Installer.PPPoEStep({owner:this,itemId:"pppoe",nextId:"dsconfig"}))}a.push(new SYNO.Installer.DSConfigStep({trackResetOnLoad:true,owner:this,itemId:"dsconfig",nextId:"apply"}),new SYNO.Installer.ApplyStep({owner:this,itemId:"apply",nextId:null}));return a},initComponent:function(){Ext.apply(this,{width:800,height:480,steps:this.prepareSteps()});if(SYNO.Installer.view.getDSInfo("buildin_storage")){this.cls="buildin-storage"}if(SYNO.Installer.view.getDSInfo("support_wireless")){this.width=740;this.height=525}SYNO.Installer.Wizard.superclass.initComponent.apply(this,arguments);this.mon(this,"activate",function(){SYNO.Installer.view.launch("redirectfail",true)},SYNO.Installer.view);this.mon(this,"deactivate",function(){this.layout.setActiveItem(0)},this)}});Ext.namespace("SYNO.Installer");SYNO.Installer.RedirectFail=Ext.extend(SYNO.JBase.IconContainer,{initComponent:function(){var b="http://find.synology.com/";var a={title:_T("wizard","error_step_title"),icon_img:"resources/icon_error_l.png",cls:"redfail",listeners:{activate:this.onActivate,scope:this}};a.button={text:_T("wizard","launch_web_assis"),handler:function(){window.location.href=b},scope:this};SYNO.Installer.RedirectFail.superclass.initComponent.apply(Ext.apply(this,a),arguments)},onActivate:function(){window.onbeforeunload=null}});Ext.namespace("SYNO.Installer");SYNO.Installer.NoDisk=Ext.extend(SYNO.JBase.IconContainer,{initComponent:function(){var c=String.format(_T("nodisk","title"),SYNO.Installer.view.getDSInfo("model","")),b=_T("nodisk","nodisk_desc"),a="resources/icon_harddisk_l.png";if(SYNO.Installer.view.getDSInfo("buildin_storage")){if(SYNO.Installer.view.getDSInfo("disk_size_enough")){c=String.format(_T("nodisk","nosd_title"),SYNO.Installer.view.getDSInfo("model",""));b=_T("nodisk","nosd_desc");a="resources/icon_sd_nosd.png"}else{c=String.format(_T("nodisk","sd_not_enough_title"),SYNO.Installer.view.getDSInfo("model",""));b=_T("nodisk","sd_not_enough_desc");a="resources/icon_sd_damage.png"}}Ext.apply(this,{title:c,icon_img:a,button:{text:_T("nodisk","conn_again"),handler:function(){SYNO.Installer.view.launch("start")},scope:this},items:{xtype:"box",cls:"desc",width:570,html:b}});SYNO.Installer.NoDisk.superclass.initComponent.apply(this,arguments)}});Ext.namespace("SYNO.Installer");SYNO.Installer.StartPage=Ext.extend(SYNO.JBase.IconContainer,{showLogo:true,initComponent:function(){Ext.apply(this,{listeners:{activate:this.onActivate,scope:this}});SYNO.Installer.StartPage.superclass.initComponent.apply(this,arguments)},loadDone:function(b,d,a){SYNO.Installer.view.unmask();var c=SYNO.JBase.Util.reportAjaxResponse(d,a,function(e){SYNO.Debug("load fail");alert(e)},this);if(!c||!c.success||!c.data){return}if(c.data.dsinfo){SYNO.Installer.view.dsinfo=c.data.dsinfo}if(!c.data.has_disk||!SYNO.Installer.view.getDSInfo("disk_size_enough")){SYNO.Installer.view.launch("nodisk");return}SYNO.Installer.view.launch("wizard")},onActivate:function(){SYNO.Installer.view.mask(_T("common","loading"));Ext.Ajax.request({url:"webman/get_state.cgi?_dc="+(new Date().getTime()),callback:this.loadDone,scope:this})}});Ext.namespace("SYNO.Installer");SYNO.Installer.View=Ext.extend(SYNO.JBase.View,{dsinfo:null,initComponent:function(){Ext.apply(this,{allPages:SYNO.Installer.View.PAGES});SYNO.Installer.View.superclass.initComponent.apply(this,arguments)},getDSInfo:function(a,b){if(this.dsinfo){return this.dsinfo[a]}return b?b:undefined},setDSInfo:function(a,b){if(this.dsinfo){this.dsinfo[a]=b}}});SYNO.Installer.View.PAGES={start:SYNO.Installer.StartPage,wizard:SYNO.Installer.Wizard,nodisk:SYNO.Installer.NoDisk,redirectfail:SYNO.Installer.RedirectFail};Ext.namespace("SYNO.Installer");Ext.onReady(function(){var b;var a=Ext.getBody();SYNO.JBase.Util.DisableUserSelection();Ext.form.VTypes.netbiosNameText=_JSLIBSTR("vtype","invalid_host");Ext.QuickTips.init();if(Ext.isIE6||Ext.isIE7){window.alert(_JSLIBSTR("common","upgrade_ie_browser"))}SYNO.Installer.view=new SYNO.Installer.View();if(Ext.isDefined(SYNO.Debug.opt)){SYNO.Debug("debug mode: "+SYNO.Debug.opt);view=SYNO.Installer.view;capture=function(c,d){Ext.util.Observable.capture(c,function(f){console.log(d||"event: ",f)})}}if(Ext.isDefined(SYNO.JBase.Util.getUrlArg("page"))&&(SYNO.JBase.Util.getUrlArg("page") in SYNO.Installer.View.PAGES)){SYNO.Installer.view.launch(SYNO.JBase.Util.getUrlArg("page"))}else{SYNO.Installer.view.launch("start")}a.scrollTo.defer(50,a,["top",0,false]);if(!SYNO.Installer.view.getActiveItem()){SYNO.Debug("no page launched, init failed")}b=SYNO.Installer.view.getDSInfo("hostname","DiskStation");window.onbeforeunload=function(){return String.format(_T("wizard","conf_exit"),b)};if(SYNO.JBase.Util.isIOS()){window.addEventListener("pagehide",function(c){alert(String.format(_T("wizard","conf_exit"),b))},false)}});